version: "3.3"

services:
  # Override web service for development with hot-reloading
  web-dev:
    build:
      context: .
      dockerfile: ./web/Dockerfile.dev
      args:
        PORT: 3030
        VITE_APP_BACKEND: http://localhost:3000
        VITE_APP_STAT_URL: http://localhost:3100
        VITE_APP_COUNTRY_NAME: "CountryX"
        VITE_APP_GOVERNMENT_MINISTRY: "Ministry Of Environment"
        VITE_APP_COUNTRY_FLAG_URL: "https://carbon-common-dev.s3.amazonaws.com/flag.png"
        VITE_APP_COUNTRY_CODE: "NG"
        VITE_APP_MAP_TYPE: "Mapbox"
        VITE_APP_MAPBOXGL_ACCESS_TOKEN: pk.eyJ1IjoicGFsaW5kYSIsImEiOiJjbGMyNTdqcWEwZHBoM3FxdHhlYTN4ZmF6In0.KBvFaMTjzzvoRCr1Z1dN_g
        VITE_APP_DEMO_MODE: "true"
    environment:
      VITE_APP_BACKEND: http://localhost:3000
      VITE_APP_MAP_TYPE: Mapbox
      VITE_APP_COUNTRY_NAME: CountryX
      VITE_APP_REGISTRY_NAME: UNDP Demo Carbon Registry
      VITE_APP_MAPBOXGL_ACCESS_TOKEN: pk.eyJ1IjoicGFsaW5kYSIsImEiOiJjbGMyNTdqcWEwZHBoM3FxdHhlYTN4ZmF6In0.KBvFaMTjzzvoRCr1Z1dN_g
      VITE_APP_MAXIMUM_FILE_SIZE: 5242880
    ports:
      - "3030:3030"
    volumes:
      # Mount source code for hot-reloading
      - ./web/src:/app/src:delegated
      - ./web/public:/app/public:delegated
      - ./web/index.html:/app/index.html:delegated
      - ./web/vite.config.ts:/app/vite.config.ts:delegated
      - ./web/tsconfig.json:/app/tsconfig.json:delegated
      - ./web/tsconfig.app.json:/app/tsconfig.app.json:delegated
      # Exclude node_modules to use container's version
      - /app/node_modules
    command: yarn dev --host 0.0.0.0 --port 3030
    depends_on:
      - db
      - national


