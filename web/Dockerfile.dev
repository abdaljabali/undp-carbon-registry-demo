FROM node:20-alpine as build

# Set build arguments
ARG PORT
ARG VITE_APP_BACKEND
ARG VITE_APP_STAT_URL
ARG VITE_APP_COUNTRY_NAME
ARG VITE_APP_GOVERNMENT_MINISTRY
ARG VITE_APP_COUNTRY_FLAG_URL
ARG VITE_APP_COUNTRY_CODE
ARG VITE_APP_MAPBOXGL_ACCESS_TOKEN
ARG VITE_APP_MAP_TYPE
ARG VITE_APP_ENABLE_REGISTRATION
ARG VITE_APP_DEMO_MODE

# Set environment variables from build args
ENV VITE_APP_BACKEND $VITE_APP_BACKEND
ENV VITE_APP_STAT_URL $VITE_APP_STAT_URL
ENV VITE_APP_COUNTRY_NAME $VITE_APP_COUNTRY_NAME
ENV VITE_APP_GOVERNMENT_MINISTRY $VITE_APP_GOVERNMENT_MINISTRY
ENV VITE_APP_COUNTRY_FLAG_URL $VITE_APP_COUNTRY_FLAG_URL
ENV VITE_APP_COUNTRY_CODE $VITE_APP_COUNTRY_CODE
ENV VITE_APP_MAPBOXGL_ACCESS_TOKEN $VITE_APP_MAPBOXGL_ACCESS_TOKEN
ENV VITE_APP_MAP_TYPE $VITE_APP_MAP_TYPE
ENV VITE_APP_ENABLE_REGISTRATION $VITE_APP_ENABLE_REGISTRATION
ENV VITE_APP_DEMO_MODE $VITE_APP_DEMO_MODE

WORKDIR /app

# Copy package files
COPY ./web/package.json ./web/yarn.lock ./

# Install dependencies (including dev dependencies for development)
RUN apk add python3 make g++ && rm -rf /var/cache/apk/*
RUN CI=false yarn install

# Copy source code
COPY ./web .

# Expose Vite dev server port
EXPOSE ${PORT}

# Start Vite dev server with hot-reloading
CMD ["yarn", "dev", "--host", "0.0.0.0", "--port", "3030"]


